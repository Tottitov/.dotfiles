#!/bin/sh

riverctl border-width 2
riverctl border-color-focused 0xBDAE93
riverctl border-color-unfocused 0x282828
riverctl border-color-urgent 0xFABD2F
riverctl default-layout rivercarro
riverctl default-attach-mode bottom

riverctl hide-cursor timeout 5000
riverctl focus-follows-cursor normal
riverctl hide-cursor when-typing enabled
riverctl set-repeat 50 300

riverctl map normal Super Q	close
riverctl map normal Super+Alt Q spawn "prompt 'Leave river?' 'riverctl exit'"

riverctl map normal Super F	toggle-fullscreen
riverctl map normal Super+Shift F toggle-float

riverctl map normal Super H	focus-view left
riverctl map normal Super J focus-view down
riverctl map normal Super K focus-view up
riverctl map normal Super L	focus-view right

riverctl map normal Super+Shift H swap left
riverctl map normal Super+Shift J swap down
riverctl map normal Super+Shift K swap up
riverctl map normal Super+Shift L swap right

riverctl map normal Control+Shift H snap left
riverctl map normal Control+Shift J snap down
riverctl map normal Control+Shift K snap up
riverctl map normal Control+Shift L snap right

riverctl map -repeat normal Super+Alt H send-layout-cmd rivercarro "main-ratio -0.02"
riverctl map -repeat normal Super+Alt L send-layout-cmd rivercarro "main-ratio +0.02"

riverctl map normal Super+Control H send-layout-cmd rivercarro "main-count -1"
riverctl map normal Super+Control L send-layout-cmd rivercarro "main-count +1"

riverctl map normal Super+Alt J send-layout-cmd rivercarro "gaps 40"
riverctl map normal Super+Alt K send-layout-cmd rivercarro "gaps 10"

riverctl map-pointer normal Shift BTN_LEFT move-view
riverctl map-pointer normal Shift BTN_RIGHT resize-view

riverctl map normal Super Return spawn "$TERMINAL"
riverctl map normal Super+Shift	Return zoom

riverctl map normal Super R spawn "$TERMINAL lf"
riverctl map normal Super+Shift R spawn menupass

riverctl map normal Super D spawn "tofi-drun --drun-launch=true"
riverctl map normal Super+Shift	D spawn menubm

riverctl map normal Super M spawn "$TERMINAL ncmpcpp"
riverctl map normal Super+Alt X spawn lock

riverctl map normal Super W spawn "$BROWSER"
riverctl map normal Super+Shift W spawn menunm

riverctl map normal Super E spawn "$TERMINAL neomutt; pkill -RTMIN+4 waybar"
riverctl map normal Super+Shift	E spawn menuemoji

riverctl map normal Super A spawn "$TERMINAL pulsemixer"
riverctl map normal Super+Shift A spawn "$TERMINAL tremc"

riverctl map normal Super N spawn "$TERMINAL $EDITOR -c 'VimwikiIndex'"
riverctl map normal Super+Shift	N spawn "$TERMINAL newsraft"

riverctl map normal Super C spawn menucalc
riverctl map normal Super+Shift	C spawn camtoggle

riverctl map normal Super Backspace spawn "prompt 'Reboot Computer?' 'sudo reboot'"
riverctl map normal Super+Shift Backspace spawn "prompt 'Shutdown Computer?' 'sudo shutdown -h now'"

riverctl map normal Super+Alt R spawn "$XDG_CONFIG_HOME/river/init >/dev/null"

riverctl input "pointer-1739-0-Synaptics_TM3053-006" tap enabled
riverctl input "pointer-1739-0-Synaptics_TM3053-006" accel-profile adaptive
riverctl input "pointer-1739-0-Synaptics_TM3053-006" natural-scroll enabled
riverctl input "pointer-1739-0-Synaptics_TM3053-006" disable-while-typing enabled
riverctl input "pointer-1739-0-Synaptics_TM3053-006" disable-while-trackpointing

riverctl rule-add -app-id "firefox" ssd
riverctl rule-add -app-id "org.pwmt.zathura" ssd
riverctl rule-add -app-id "spek" ssd
riverctl rule-add -app-id "imv" ssd

for mode in normal locked; do
    riverctl map $mode Super Equal spawn "volume high"
    riverctl map $mode Super Minus spawn "volume low"
    riverctl map $mode Super+Shift Equal spawn "volume higher"
    riverctl map $mode Super+Shift Minus spawn "volume lower"

    riverctl map $mode Super+Shift M spawn "volume mute"
    riverctl map $mode Super+Alt M spawn "volume mic"

    riverctl map $mode None	XF86AudioRaiseVolume spawn "volume high"
    riverctl map $mode None XF86AudioLowerVolume spawn "volume low"
    riverctl map $mode None XF86AudioMute spawn "volume mute"
    riverctl map $mode None XF86AudioMicMute spawn "volume mic"

    riverctl map $mode None XF86MonBrightnessUp spawn "brightnessctl -qe s +10%"
    riverctl map $mode None XF86MonBrightnessDown spawn "brightnessctl -qe s 10%-"

    riverctl map $mode Super P spawn "mpc -q toggle; mpdstatus"
    riverctl map $mode Super+Alt P spawn "mpc -q clear; mpdstatus"

    riverctl map $mode Super Comma spawn "mpc -q prev; mpdstatus"
    riverctl map $mode Super Period spawn "mpc -q next; mpdstatus"

    riverctl map $mode Super+Shift Comma spawn "mpc -q seek -5%"
    riverctl map $mode Super+Shift Period spawn "mpc -q seek +5%"

    riverctl map $mode Super+Alt Comma spawn "mpc -q seek 0%"
done

riverctl map normal None XF86DISPLAY spawn ""
riverctl map normal None XF86WLAN spawn airplane
riverctl map normal None XF86Tools spawn "$TERMINAL lf ~/.config"
riverctl map normal None XF86Search spawn "tofi-drun --drun-launch=true"
riverctl map normal None XF86LaunchA spawn eject
riverctl map normal None XF86Explorer spawn "menucalc"

riverctl map normal None Print spawn "grimpick screenshotc"
riverctl map normal Shift Print spawn "grimpick fullscreenc"
riverctl map normal Alt Print spawn grimpick

riverctl map normal Super Print spawn menurecord
riverctl map normal Super+Shift	Print spawn menurecord kill

scratchTag=$(( 1 << 20 ))
riverctl map normal Super 0 toggle-focused-tags $scratchTag
riverctl map normal Super+Shift 0 set-view-tags $scratchTag
riverctl spawn-tagmask $(( ((1 << 32) - 1) ^ scratchTag ))

stickyTag=$(( 1 << 10 ))
riverctl map normal Super S toggle-view-tags $stickyTag
riverctl spawn-tagmask $(( ((1 << 32) - 1) ^ stickyTag ))

for i in $(seq 1 9); do
    tags=$(( 1 << (i - 1) ))
    riverctl map normal Super "$i" set-focused-tags $(( stickyTag + tags ))
    riverctl map normal Super+Shift "$i" set-view-tags $tags
	riverctl map normal Super+Alt "$i" toggle-focused-tags $tags
done

dbus-update-activation-environment SEATD_SOCK WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=river

executes="waybar kanshi wbg rivercarro foot pipewire dunst mpd"
for execute in $executes; do
    pgrep -x "$execute" && continue
    case $execute in
        "foot") "$execute" --server & ;;
        "wbg") "$execute" "${XDG_DATA_HOME}/bg" & ;;
        "rivercarro") "$execute" -inner-gaps 10 -outer-gaps 10 -no-smart-gaps & ;;
        *) "$execute" & ;;
    esac
done >/dev/null 2>&1

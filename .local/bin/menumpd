#!/bin/sh

add() {
	mpc -q clear
	mpc -q findadd "$@"
	mpc -q play
}

artist=$(mpc ls | fuzzel -l 20 -di) || exit 0
albums=$(mpc list album artist "$artist")
albumCount=$(echo "$albums" | wc -l)

if [ "$albumCount" -eq 1 ]; then
	album="$albums"
else
	album=$(echo "$albums" | fuzzel -l "$albumCount" -di) || exit 0
fi

choice=$(
	printf "Nope\nSure" | fuzzel -l 2 -w 50 -dip "Add album '$album' to playlist ?"
) || exit 0

if [ "$choice" = "Nope" ]; then
	songs=$(
		mpc search -f "%track%\t%title%" album "$album" | sort -n -k1,1 | cut -f2-
	) || exit 0
	songCount=$(echo "$songs" | wc -l)
	song=$(echo "$songs" | fuzzel -l "$songCount" -di)
	add title "$song"
else
	add album "$album"
fi

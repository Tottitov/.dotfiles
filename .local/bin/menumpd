#!/bin/sh

add() { mpc -q clear && mpc -q findadd "$@"; }

artist=$(mpc ls | fuzzel -di) || exit 0
albums=$(mpc list album artist "$artist")
count=$(echo "$albums" | wc -l)

if [ "$count" -eq 1 ]; then
	album="$albums"
else
	album=$(echo "$albums" | fuzzel -di) || exit 0
fi

choice=$(
	printf "Nope\nSure" | fuzzel -l 2 -dip "Add $album to playlist ?"
) || exit 0

if [ "$choice" = "Nope" ]; then
	song=$(
		mpc search -f "%track%\t%title%" \
			album "$album" | sort -n -k1,1 | cut -f2- | fuzzel -di
	) || exit 0
	add title "$song"
else
	add album "$album"
fi

mpc -q play && pkill -RTMIN+1 waybar
